---

version: 1

config_files:
  docker-compose.override.sample.yml: docker-compose.override.yml
  docker-compose.prod.sample.yml: docker-compose.prod.yml
  .env.example: .env
  ops/config/nginx/prod.sample: ops/config/nginx/prod.conf

install_tasks:
  - npm
  - composer
  - key:generate
  - bower
  - gulp
  - db:update

tasks:
  - name: key:generate
    container: app
    command:
      - sh
      - -c 
      - if ! grep -q -E ^APP_KEY=[A-Za-z0-9]{32}$ .env; then php artisan key:generate; fi 

backup:
  files:
    - storage/app
  databases:
    - container: db
